var config={apiKey:"AIzaSyChU-JMvCeFw5s607Drcmazxxr0K7rn8PQ",authDomain:"kiriventure-kit.firebaseapp.com",databaseURL:"https://kiriventure-kit.firebaseio.com",projectId:"kiriventure-kit",storageBucket:"kiriventure-kit.appspot.com",messagingSenderId:"523269006984"};firebase.initializeApp(config);var date=new Date,dd=date.getDate(),mm=date.getMonth()+1,yyyy=date.getFullYear();dd<10&&(dd="0"+dd),mm<10&&(mm="0"+mm);var today=dd+"/"+mm+"/"+yyyy,getRef=function(){return firebase.database().ref()},getAllFlowsByDepartmet=function(e){var n=[];return new Promise(function(t,a){try{getRef().child("Flows").orderByChild("department").equalTo(e).on("child_added",function(e){n.push({name:e.val().flowName,id:e.key}),t(n)})}catch(e){a(e)}})},getAllDepartment=function(){var e=[];return new Promise(function(n,t){try{getRef().child("Departments").on("child_added",function(t){e.push({name:t.val().name,id:t.key}),n(e)})}catch(e){t(e)}})},getAllTasksByDepartment=function(e){var n=[];return new Promise(function(t,a){try{getRef().child("Tasks").orderByChild("department").equalTo(e).on("child_added",function(e){getRef().child("Flows/"+e.val().flow).on("value",function(t){t.val()&&n.push({id:e.key,name:e.val().name,flow:t.val().flowName})}),t(n)})}catch(e){console.log(e),a(e)}})},getFlowByID=function(e){return new Promise(function(n,t){try{getRef().child("Flows/"+e).on("value",function(e){n({name:e.val().flowName})})}catch(e){console.log(e),t(e)}})},getAllMemberByDepartment=function(e){var n=[];return new Promise(function(t,a){try{getRef().child("Users").orderByChild("department").equalTo(e).on("child_added",function(e){n.push(e.val()),n[n.length-1].id=e.key,t(n)})}catch(e){console.log(e),a(e)}})},getCheckedTasks=function(e,n){var t=[],a=[];return new Promise(function(o,i){try{getRef().child("Users").orderByChild("department").equalTo(e).on("child_added",function(e){getRef().child("Ratings").orderByChild("data").equalTo(n).on("child_added",function(n){if(e.key===n.val().user)if(0===a.length){t.push(n.val()),t[t.length-1].review="";for(var i=0;i<t.length;i++)for(var r=0;r<t[i].task.length;r++)getRef().child("Tasks/"+t[i].task[r].id).on("value",function(e){t[i].task[r].name=e.val().name});a.push(n.val().user),getRef().child("Users/"+n.val().user).on("value",function(e){t[t.length-1].username=e.val().name})}else if(a.indexOf(n.val().user)>=0)t.forEach(function(e,a){if(e.user===n.val().user&&n.val().task)for(var o=0;o<n.val().task.length;o++)t[a].task.push(n.val().task[o]),getRef().child("Tasks/"+n.val().task[o].id).on("value",function(e){t[a].task[t[a].task.length-1].name=e.val().name})});else{t.push(n.val()),t[t.length-1].review="";for(i=0;i<t.length;i++)for(r=0;r<t[i].task.length;r++)getRef().child("Tasks/"+t[i].task[r].id).on("value",function(e){t[i].task[r].name=e.val().name});a.push(n.val().user),getRef().child("Users/"+n.val().user).on("value",function(e){t[t.length-1].username=e.val().name})}o(t)})})}catch(e){console.log(e),i(e)}})},addNewTask=function(e,n,t){return new Promise(function(a,o){try{getRef().child("Tasks").push({department:e,flow:n,name:t}).then(function(e){a(e)})}catch(e){o(e)}})},updateTaskWithFlow=function(e,n,t){return new Promise(function(a,o){try{getRef().child("Tasks/"+n).update({flow:e,name:t}).then(function(e){console.log(e),a(e)})}catch(e){o(e)}})},updateTask=function(e,n){return new Promise(function(t,a){try{getRef().child("Tasks/"+e).update({name:n}).then(function(e){t(e)})}catch(e){a(e)}})},deleteTask=function(e){return new Promise(function(n,t){try{getRef().child("Tasks/"+e).on("value",function(e){e.ref.remove(),n(!0)})}catch(e){t(e)}})},addNewFlow=function(e,n){return new Promise(function(t,a){try{getRef().child("Flows").push({department:e,flowName:n}).then(function(e){t(e)})}catch(e){a(e)}})},deleteFlow=function(e){return new Promise(function(n,t){try{getRef().child("Flows/"+e).on("value",function(e){e.ref.remove(),n(!0)})}catch(e){console.log(e),t(e)}})},updateFlow=function(e,n){return new Promise(function(t,a){try{getRef().child("Flows/"+e).update({flowName:n}).then(function(e){t(e)})}catch(e){console.log(e),a(e)}})},addNewUser=function(e,n,t,a){return new Promise(function(o,i){try{getRef().child("Users").push({department:e,name:n,email:t,position:a}).then(function(e){o(e)})}catch(e){console.log(e),i(e)}})},deleteUser=function(e){return new Promise(function(n,t){try{getRef().child("Users/"+e).on("value",function(e){e.ref.remove(),n(!0)})}catch(e){console.log(e),t(e)}})},updateUser=function(e,n,t){return new Promise(function(a,o){try{getRef().child("Users/"+e).update({name:n,position:t}).then(function(e){a(e)})}catch(e){console.log(e),o(e)}})},submitManagerRating=function(e,n,t){return new Promise(function(a,o){try{getRef().child("MRatings").push({ratingUser:e,rating:n,rateDate:t,date:today}).then(function(e){a(e)})}catch(e){console.log(e),o(e)}})};